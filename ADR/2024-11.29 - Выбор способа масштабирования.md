**Дата:** 29 ноября 2024 г.

**Статус:** Предложено

**Контекст:**

По нефункциональным требованиям нам необходимо обеспечить высокую доступность и отказоустойчивость сервиса стриминга музыки. А так же нам необходимо эффективно управлять постоянно увеличивающимся объемом данных пользователей. Еще нам требуется быстрый доступ к данным пользователей из разных регионов. Единственный сервер баз данных не справится, поэтому требуется оптимизация для достижения поставленных задач.

**Рассмотренные варианты:**

1. _Кэширование данных:_ метод сохранения результатов запросов.
2. _Асинхронная обработка:_ Использование асинхронной обработки может улучшить производительность микросервисов. Особенно это касается тех случаев, когда запросы требуют длительного времени обработки или связаны с внешними сервисами.
3. _Горизонтальное масштабирование:_ Увеличение производительности за счёт разделения данных на множество серверов. Такой способ предполагает увеличение производительности без снижения отказоустойчивости.
4. _Репликация:_ копирование данных между серверами.
5. _Автоматическое масштабирование:_ изменение размера группы узлов, количества подов или количества выделяемых каждому поду ресурсов на основе запросов ресурсов для подов, запущенных на узлах этой группы.

**Решение:**

Региональная сегментация(sharding) позволяет распределять данные по разным регионам тем самым повышая производительность пользователей в разных регионах России и сокращая время отклика.
Реализация региональной сегментации базы данных PostgreSQL включает в себя следующие компоненты:

- Шардирование
- Репликация
- Балансировка нагрузки
- Кэширование данных

Предлагается на каждый крупный регион России расположить по одному серверу до необходимости масштабирования:

- Москва
- Санкт-Петербург
- Калужская область
- Татарстан (Казань)
- Новосибирская область (Новосибирск)
- Свердловская область (Екатеринбург)
- Краснодарский край (Краснодар)
- Челябинская область (Челябинск)
- Ростовская область (Ростов-на-Дону)
- Приморский край (Владивосток)
- Республика Саха (Якутск)
- Чукотский автономный округ (Анадырь)

**Обоснование:**

- За счет сокращения времени отклика повысилась производительность для пользователей из разных регионов.
- Повышается отказоустойчивость за счет репликации и балансировки нагрузки.
- Появилась возможность расширять систему в ответ на возросшую нагрузку.

**Последствия:**

- Сложность архитектуры и необходимость дополнительной настройки и мониторинга.
- Потенциальные проблемы с согласованностью данных в разных регионах требуют дополнительных механизмов.
